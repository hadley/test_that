test_that("can skip with raw logicals", {
  expect_skip(skip_if_not(FALSE))
  expect_skip(skip_if(TRUE))

  expect_no_skip(skip_if_not(TRUE))
  expect_no_skip(skip_if(FALSE))
})

test_that("skip_empty generates skip", {
  expect_skip(skip_empty())
})

test_that("can skip based on package installation status", {
  expect_no_skip(skip_if_not_installed("testthat"))

  expect_skip(skip_if_not_installed("INVALID PACAGKE"))
  expect_skip(skip_if_not_installed("testthat", "9999.9999.999"))
})

test_that("can skip with env vars", {
  expect_skip_with_env <- function(new, skip_fun) {
    expect_no_skip(skip_fun())
    withr::with_envvar(new, expect_skip(skip_fun()))
  }
  expect_skip_with_env(c("NOT_CRAN" = "false"), skip_on_cran)
  expect_skip_with_env(c("TRAVIS" = "true"), skip_on_travis)
  expect_skip_with_env(c("APPVEYOR" = "True"), skip_on_appveyor)
  expect_skip_with_env(c("BBS_HOME" = "asdf"), skip_on_bioc)
  expect_skip_with_env(c("CI" = "true"), skip_on_ci)

  withr::local_envvar(c("R_COVR" = "false"))
  expect_skip_with_env(c("R_COVR" = "true"), skip_on_covr)
})

test_that("can skip in translated environments", {
  expect_no_skip(skip_if_translated())
  withr::local_envvar(c("LANG" = "de"))
  expect_skip(skip_if_translated())
})

test_that("os skipping validates input", {
  expect_error(skip_on_os("blother"))
})

test_that("can skip on multiple OSs", {
  expect_skip(skip_on_os(c("windows", "mac", "linux", "solaris")))
})

test_that("autogenerated message is always single line", {
  a_very_long_argument_name <- FALSE

  cnd <- capture_condition(skip_if_not(
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name ||
    a_very_long_argument_name
  ))

  expect_length(cnd$message, 1)
})
